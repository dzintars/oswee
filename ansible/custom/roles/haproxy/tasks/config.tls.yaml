---
# tasks file for haproxy

- name: config | Ensure Prod certs directory exists
  become: true
  ansible.become.file:
    path: '/etc/letsencrypt/live/{{ dns_prod_domain_name }}'
    state: directory
    mode: '0755'

- name: config | Ensure Dev certs directory exists
  become: true
  ansible.become.file:
    path: '/etc/letsencrypt/live/{{ dns_dev_domain_name }}'
    state: directory
    mode: '0755'

- name: config | Copy Prod TLS certificates from Ansible Vault
  become: true
  ansible.builtin.copy:
    content: '{{ tls_certs[0].content }}'
    dest: '/etc/letsencrypt/live/{{ dns_prod_domain_name }}/haproxy.pem'
    owner: '{{ haproxy_user }}'
    group: '{{ haproxy_group }}'
    mode: 'u=rw,g=r,o='

- name: config | Copy Dev TLScertificates from Ansible Vault
  become: true
  ansible.builtin.copy:
    content: '{{ tls_certs[1].content }}'
    dest: '/etc/letsencrypt/live/{{ dns_dev_domain_name }}/haproxy.pem'
    owner: '{{ haproxy_user }}'
    group: '{{ haproxy_group }}'
    mode: 'u=rw,g=r,o='
