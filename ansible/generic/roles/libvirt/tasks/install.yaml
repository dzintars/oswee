---
# tasks file for libvirt

- name: install | Install libvirt dependencies
  become: true
  ansible.builtin.dnf:
    name: '{{ item }}'
    state: present
  loop: '{{ packages.redhat }}'

# Create libvirt group and add current user to it to allow to run libvirt without root

# TODO: Some of these tasks changes home directory group to libvirt
- name: install | Create libvirt system group
  become: true
  ansible.builtin.group:
    name: libvirt
    state: present
    system: true

- name: install | Add {{ ansible_user_id }} to libvirt group
  become: true
  ansible.builtin.user:
    name: '{{ ansible_user_id }}'
    groups:
      - libvirt
    append: true
    state: present

- name: install | Just force systemd to re-execute itself (2.8 and above)
  become: true
  ansible.builtin.systemd:
    daemon_reexec: true

- name: install | Start libvirtd service
  become: true
  ansible.builtin.service:
    name: libvirtd
    state: started
    enabled: true
...
