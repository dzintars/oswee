---
# tasks file for libvirt

- name: Install libvirt dependencies
  become: true
  ansible.builtin.dnf:
    name: '{{ item }}'
    state: latest
  loop: '{{ packages.redhat }}'

# Create libvirt group and add current user to it to allow to run libvirt without root

# TODO: Some of these tasks changes home directory group to libvirt
- name: Create libvirt system group
  become: true
  ansible.builtin.group:
    name: libvirt
    state: present
    system: true

- name: Add {{ ansible_user_id }} to libvirt group
  become: true
  ansible.builtin.user:
    name: '{{ ansible_user_id }}'
    groups:
      - libvirt
    append: true
    state: present

- name: Just force systemd to re-execute itself (2.8 and above)
  become: true
  ansible.builtin.systemd:
    daemon_reexec: true

# id $(whoami)

# Start and enable libvirtd

- name: Start libvirtd service
  become: true
  ansible.builtin.service:
    name: libvirtd
    state: started
    enabled: true
