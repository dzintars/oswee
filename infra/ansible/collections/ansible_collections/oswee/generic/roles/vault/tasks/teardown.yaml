---
# tasks file for Vault

- name: teardown | Stop Vault server
  become: true
  ansible.builtin.systemd:
    name: '{{ vault_service_name }}.service'
    state: stopped
    enabled: false

- name: teardown | Remove Systemd service unit file
  become: true
  ansible.builtin.file:
    path: /etc/systemd/system/vault.service
    state: absent

- name: teardown | Force systemd to re-execute itself
  become: true
  ansible.builtin.systemd:
    daemon_reexec: true

- name: teardown | Remove packages
  become: true
  ansible.builtin.dnf:
    name: '{{ item }}'
    state: absent
  loop: '{{ packages.redhat }}'

- name: teardown | Remove secrets
  ansible.builtin.file:
    path: '{{ vault_secrets_path }}'
    state: absent

- name: teardown | Remove Vault data directories
  become: true
  ansible.builtin.file:
    path: '{{ vault_data }}'
    state: absent

- name: teardown | Remove Vault config
  become: true
  ansible.builtin.file:
    path: '{{ vault_config_path }}'
    state: absent
...
