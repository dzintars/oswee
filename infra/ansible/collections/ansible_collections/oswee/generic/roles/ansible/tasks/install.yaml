---
# tasks file for Ansible

- name: install | Install ansible-lint python package
  ansible.builtin.pip:
    name: ansible-lint
    state: forcereinstall

- name: install | Install Hashicorp Vault module
  ansible.builtin.pip:
    name: hvac
    state: forcereinstall

- name: install | Install NPM ansible-language-server package globally
  community.general.yarn:
    name: '@ansible/ansible-language-server@latest'
    global: true

- name: install | Create Ansible system group
  become: true
  ansible.builtin.group:
    name: '{{ ansible_group }}'
    state: present
    system: true

- name: install | Allow 'ansible' group to have passwordless sudo
  become: true
  ansible.builtin.lineinfile:
    dest: /etc/sudoers
    state: present
    regexp: '^%ansible'
    line: '%ansible ALL=(ALL) NOPASSWD: ALL'
    validate: visudo -cf %s

- name: install | Create Ansible user
  become: true
  ansible.builtin.user:
    name: '{{ ansible_user }}'
    home: '{{ ansible_home }}'
    # create_home: true
    append: true
    shell: /bin/false  # TODO: Does this will allow to execute SSH Cert rotation?
    groups: '{{ ansible_group }}'
...
