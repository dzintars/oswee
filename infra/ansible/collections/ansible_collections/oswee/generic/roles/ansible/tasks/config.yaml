---
# tasks/config.yaml file for oswee.generic.ansible role

- name: config | Create Ansible system group
  become: true
  ansible.builtin.group:
    name: '{{ ansible_group }}'
    state: present
    system: true

- name: config | Allow 'ansible' group to have passwordless sudo
  become: true
  ansible.builtin.lineinfile:
    dest: /etc/sudoers
    state: present
    regexp: ^%ansible
    line: '%ansible ALL=(ALL) NOPASSWD: ALL'
    validate: visudo -cf %s

- name: config | Create Ansible user
  become: true
  ansible.builtin.user:
    name: '{{ ansible_user }}'
    home: '{{ ansible_home }}'
    append: true
    shell: /bin/false  # TODO: Does this will allow to execute SSH Cert rotation?
    groups: '{{ ansible_group }}'

- name: config | Create secrets directory
  become: true
  ansible.builtin.file:
    path: /home/ansible/.secrets
    state: directory
    owner: '{{ ansible_user }}'
    group: '{{ ansible_group }}'
    mode: '0644'

- name: config | Add PY_COLORS env to .zshenv
  ansible.builtin.lineinfile:
    dest: '{{ ansible_env.HOME }}/.config/zsh/.zshenv'
    line: export PY_COLORS=1
...
