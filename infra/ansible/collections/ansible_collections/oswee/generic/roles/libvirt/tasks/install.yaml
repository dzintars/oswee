---
# tasks file for Libvirt

- name: install | Install libvirt dependencies
  become: true
  ansible.builtin.dnf:
    name: '{{ item }}'
    state: present
  loop: '{{ packages.redhat }}'

# TODO: Some of these tasks changes home directory group to libvirt
- name: install | Create libvirt system group
  become: true
  ansible.builtin.group:
    name: '{{ libvirt_group }}'
    state: present
    system: true

- name: install | Add user to libvirt group
  become: true
  ansible.builtin.user:
    name: '{{ libvirt_system_user }}'
    groups:
      - '{{ libvirt_group }}'
    append: true
    state: present

- name: install | Just force systemd to re-execute itself (2.8 and above)
  become: true
  ansible.builtin.systemd:
    daemon_reexec: true

- name: install | Enable and start libvirtd service
  become: true
  ansible.builtin.service:
    name: libvirtd
    state: started
    enabled: true
...
