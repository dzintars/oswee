---
# tasks file for Hyprland

# - name: install | Create temporary install directory
#   ansible.builtin.tempfile:
#     path: '{{ ansible_env.HOME }}'
#     state: directory
#     suffix: .install
#   register: temp_install_dir
#   changed_when: false

# dnf install autoconf xcb-proto xorg-x11-util-macros automake libxcb-devel
#
# git clone https://gitlab.freedesktop.org/xorg/lib/libxcb-errors --recursive
# cd libxcb-errors
# ./autogen.sh --prefix=/usr
# make install

# - name: install | Clone libxcb-errors repository
#   ansible.builtin.git:
#     repo: https://gitlab.freedesktop.org/xorg/lib/libxcb-errors
#     dest: '{{ libxcb_source_path }}'
#     # version: main
#
# - name: install | Install libxcb-errors dependencies
#   become: true
#   ansible.builtin.dnf:
#     name: '{{ item }}'
#     state: present
#   loop:
#     # - dh-autoreconf
#     - xorg-x11-util-macros
#     - xcb-proto
#     - autoconf
#     - automake
#     - libxcb-devel
#
# - name: install | Build libxcb
#   ansible.builtin.command: ./autogen.sh --prefix=/usr
#   args:
#     chdir: '{{ libxcb_source_path }}'
#
# - name: install | Install libxcb-errors
#   # become: true
#   community.general.make:
#     chdir: '{{ libxcb_source_path }}'
#     target: install

- name: install | Download Hyprland prebuilt release source
  ansible.builtin.unarchive:
    src: https://github.com/hyprwm/Hyprland/releases/download/v0.21.0beta/v0.21.0beta.tar.gz
    # src: '{{ hyprland_prebuilt_url }}'
    dest: /tmp
    # owner: '{{ hyprland_user }}'
    # group: '{{ hyprland_group }}'
    remote_src: true
    # Strip the top level directory
    # extra_opts: [--strip-components=1]

- name: install | Copy Hyprland binary
  become: true
  ansible.builtin.copy:
    src: /tmp/hyprland/Hyprland
    dest: /usr/bin
    mode: a+x
    remote_src: true

- name: install | Copy hyprctl binary
  become: true
  ansible.builtin.copy:
    src: /tmp/hyprland/hyprctl
    dest: /usr/bin
    mode: a+x
    remote_src: true

- name: install | Copy hyprctl binary
  become: true
  ansible.builtin.copy:
    src: /tmp/hyprland/libwlroots.so.12032
    dest: /usr/lib
    mode: 0755
    remote_src: true

- name: install | Copy Hyprland desktop entry
  become: true
  ansible.builtin.copy:
    src: /tmp/hyprland/example/hyprland.desktop
    dest: /usr/share/wayland-sessions
    mode: 0644
    remote_src: true

- name: install | Ensure config directory exists
  ansible.builtin.file:
    path: '{{ ansible_env.HOME }}/.config/hypr/'
    state: directory
    mode: 0755

- name: install | Copy Hyprland example config
  ansible.builtin.copy:
    src: /tmp/hyprland/example/hyprland.conf
    dest: '{{ ansible_env.HOME }}/.config/hypr/'
    mode: 0644
    remote_src: true
...
