---
# tasks file for Hyprland

- name: install | Clone repository
  ansible.builtin.git:
    repo: https://github.com/hyprwm/Hyprland
    dest: '{{ hyprland_source_path }}'
    # version: main
  register: hyprland_repo

# - name: install | Cleanup build artifacts
#   ansible.builtin.command: meson setup --wipe _build
#   args:
#     chdir: '{{ hyprland_source_path }}'
  # when: hyprland_repo.changed

# Hyprland protocols

- name: install | Meson build hyprland-protocols
  ansible.builtin.command: meson setup _build
  args:
    chdir: '{{ hyprland_source_path }}/subprojects/hyprland-protocols'
  # when: hyprland_repo.changed

- name: install | Ninja install hyprland-protocols
  become: true
  ansible.builtin.command: ninja -C _build install
  args:
    chdir: '{{ hyprland_source_path }}/subprojects/hyprland-protocols'
  # when: hyprland_repo.changed

# protocols/meson.build:38:1: ERROR: File //usr/local/share/hyprland-protocols/protocols/hyprland-toplevel-export-v1.xml does not exist.
- name: install | Create hyprland-protocols symlink
  become: true
  ansible.builtin.file:
    src: '{{ hyprland_source_path }}/subprojects/hyprland-protocols'
    path: /usr/local/share/hyprland-protocols
    state: link
    force: true

# Wlroots

#  meson build/
# ninja -C build/
# sudo ninja -C build/ install

- name: install | Meson build wlroots
  ansible.builtin.command: meson setup build/
  args:
    chdir: '{{ hyprland_source_path }}/subprojects/wlroots'
  # when: hyprland_repo.changed

- name: install | Ninja install wlroots
  become: true
  ansible.builtin.command: ninja -C build/ install
  args:
    chdir: '{{ hyprland_source_path }}/subprojects/wlroots'
  # when: hyprland_repo.changed

# Hyprland

- name: install | Meson build hyprland
  ansible.builtin.command: meson setup _build
  args:
    chdir: '{{ hyprland_source_path }}'
  # when: hyprland_repo.changed

- name: install | Ninja build hyprland
  ansible.builtin.command: ninja -C _build
  args:
    chdir: '{{ hyprland_source_path }}'
  # when: hyprland_repo.changed

- name: install | Ninja install
  become: true
  ansible.builtin.command: ninja -C _build install
  args:
    chdir: '{{ hyprland_source_path }}'
  # when: hyprland_repo.changed

# - name: install | Change swaylock binary permissions
#   become: true
#   ansible.builtin.file:
#     path: /usr/bin/swaylock
#     mode: a+s
...
