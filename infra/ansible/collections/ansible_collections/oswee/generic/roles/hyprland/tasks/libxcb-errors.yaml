---
# tasks/libxcb-errors.yaml file for oswee.generic.hyprland role

- name: libxcb-errors | Source build
  when: libxcb_source_build | default(true) | bool
  block:
    - name: libxcb-errors | Clone libxcb-errors repository
      ansible.builtin.git:
        repo: https://gitlab.freedesktop.org/xorg/lib/libxcb-errors
        dest: '{{ libxcb_source_path }}'
        # version: main

    - name: libxcb-errors | Install libxcb-errors dependencies
      become: true
      ansible.builtin.dnf:
        name: '{{ item }}'
        state: present
      loop:
        # - dh-autoreconf
        - xorg-x11-util-macros
        - xcb-proto
        - autoconf
        - automake
        - libxcb-devel

    - name: libxcb-errors | Build libxcb
      ansible.builtin.command: ./autogen.sh --prefix=/usr
      args:
        chdir: '{{ libxcb_source_path }}'

    - name: libxcb-errors | Install libxcb-errors
      # become: true
      community.general.make:
        chdir: '{{ libxcb_source_path }}'
        target: install

- name: libxcb-errors | OpenSUSE version install
  when: not (libxcb_source_build | default(false) | bool)
  block:
    - name: libxcb-errors | Install libxcb-errors
      become: true
      ansible.builtin.dnf:
        name: https://ftp.lysator.liu.se/pub/opensuse/tumbleweed/repo/oss/x86_64/libxcb-errors0-1.0.1-1.1.x86_64.rpm
        state: present
...
