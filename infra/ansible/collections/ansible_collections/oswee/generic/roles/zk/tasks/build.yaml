---
# tasks file for Zk

- name: build | Clone Zk repository
  ansible.builtin.git:
    repo: '{{ zk_repo_url }}'
    dest: '{{ zk_source_dir }}'
    version: main
    depth: 1
  register: zk_repo

- name: build | Cleanup build artifacts
  community.general.make:
    chdir: '{{ zk_source_dir }}'
    target: clean
  when: zk_repo.changed

- name: build | Build Zk from the source
  community.general.make:
    chdir: '{{ zk_source_dir }}'
    target: build
  when: zk_repo.changed
  # register: zk_build

# Make sure GOBIN is set correctly. In my case it points to ~/go/bin in Nushell env.nu
- name: build | Install build version of the ZK
  community.general.make:
    chdir: '{{ zk_source_dir }}'
    target: install
  # when: zk_build.changed
...
