---
# tasks/environment.yaml file for oswee.custom.sway role

# TODO: I don't like this whole thing. It couples this and ZSH roles together
- name: environment | Add Sway environment
  become: true
  ansible.builtin.copy:
    dest: '{{ ansible_env.HOME }}/.config/zsh/sway'
    mode: '0644'
    content: |
      export XDG_SESSION_TYPE=wayland
      export XDG_SESSION_DESKTOP=sway
      export XDG_CURRENT_DESKTOP=sway
      export XDG_CURRENT_SESSION_TYPE=wayland
      export DESKTOP_SESSION=sway

      export XKB_DEFAULT_LAYOUT=us

      export LIBSEAT_BACKEND=logind

      export QT_WAYLAND_DISABLE_WINDOWDECORATION=1
      export QT_QPA_PLATFORM=wayland-egl
      export QT_WAYLAND_FORCE_DPI=physical

      export GDG_BACKEND="wayland"

      export CLUTTER_BACKEND=wayland
      export SDL_VIDEODRIVER=wayland
      export WLR_DRM_DEVICES=/dev/dri/card1

      export WLR_DRM_NO_MODIFIERS=1
      export MOZ_ENABLE_WAYLAND=1

      export _JAVA_AWT_WM_NONREPARENTING=1

- name: environment | Run Sway at ZSH login
  ansible.builtin.lineinfile:
    dest: '{{ ansible_env.HOME }}/.config/zsh/.zlogin'
    line: '[ "$(tty)" = "/dev/tty1" ] && exec sway'

...
