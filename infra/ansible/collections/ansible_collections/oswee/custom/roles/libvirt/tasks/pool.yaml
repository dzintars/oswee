---
# tasks file for Libvirt

- name: Define Storage
  community.libvirt.virt_pool:
    command: define
    uri: "{{ connection_uri }}"
    name: "{{ pool_name}}"
    xml: '{{ lookup("template", "storage/raptor.xml.j2") }}'

# - name: Get XML data of a specified pool
#   community.libvirt.virt_pool:
#     command: get_xml
#     name: "{{ pool_name}}"
#   register: raptor
#
# - name: Print Storage Info
#   ansible.builtin.debug:
#     msg: Storage info {{ raptor }}
#
- name: "Start {{ pool_name }} libvirt pool"
  community.libvirt.virt_pool:
    name: "{{ pool_name}}"
    state: active

- name: "Set autostart {{ pool_name }} libvirt pool"
  community.libvirt.virt_pool:
    name: "{{ pool_name }}"
    autostart: true

# - name: Load Storage
#   community.libvirt.virt_pool:
#     command: info
#     uri: "{{ connection_uri }}"
#   register: storage_pools

# - name: Print Storage Info
#   ansible.builtin.debug:
#     msg: Storage info {{ storage_pools.pools }}
...
